# 2.2 è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æ

## 2.2.1 è¯æ³•åˆ†æ

æºä»£ç åœ¨è®¡ç®—æœºã€çœ¼ä¸­ã€å…¶å®æ˜¯ä¸€å›¢ä¹±éº»ï¼Œä¸€ä¸ªç”±å­—ç¬¦ç»„æˆçš„ã€æ— æ³•è¢«ç†è§£çš„å­—ç¬¦ä¸²ï¼Œæ‰€æœ‰çš„å­—ç¬¦åœ¨è®¡ç®—å™¨çœ‹æ¥å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä¸ºäº†ç†è§£è¿™äº›å­—ç¬¦æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯**å°†å­—ç¬¦ä¸²åˆ†ç»„**ï¼Œè¿™èƒ½å¤Ÿé™ä½ç†è§£å­—ç¬¦ä¸²çš„æˆæœ¬ï¼Œç®€åŒ–æºä»£ç çš„åˆ†æè¿‡ç¨‹ã€‚

```go
make(chan int)
```

å“ªæ€•æ˜¯ä¸æ‡‚ç¼–ç¨‹çš„äººçœ‹åˆ°ä¸Šè¿°æ–‡æœ¬çš„ç¬¬ä¸€ååº”ä¹Ÿåº”è¯¥ä¼šå°†ä¸Šè¿°å­—ç¬¦ä¸²åˆ†æˆå‡ ä¸ªéƒ¨åˆ† - `make`ã€`chan`ã€`int` å’Œæ‹¬å·ï¼Œè¿™ä¸ªå‡­ç›´è§‰åˆ†è§£æ–‡æœ¬çš„è¿‡ç¨‹å°±æ˜¯[è¯æ³•åˆ†æ](https://en.wikipedia.org/wiki/Lexical_analysis)ï¼Œè¯æ³•åˆ†ææ˜¯å°†å­—ç¬¦åºåˆ—è½¬æ¢ä¸ºæ ‡è®°ï¼ˆtokenï¼‰åºåˆ—çš„è¿‡ç¨‹[<sup>2</sup>](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fn:2)ã€‚

### lex

[lex](http://dinosaur.compilertools.net/lex/index.html)<sup>3</sup> æ˜¯ç”¨äºç”Ÿæˆè¯æ³•åˆ†æå™¨çš„å·¥å…·ï¼Œlex ç”Ÿæˆçš„ä»£ç èƒ½å¤Ÿå°†ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å­—ç¬¦åˆ†è§£æˆ Token åºåˆ—ï¼Œå¾ˆå¤šè¯­è¨€åœ¨è®¾è®¡æ—©æœŸéƒ½ä¼šä½¿ç”¨å®ƒå¿«é€Ÿè®¾è®¡å‡ºåŸå‹ã€‚lex ä½œä¸ºä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œä½¿ç”¨äº†ç±»ä¼¼ C è¯­è¨€çš„è¯­æ³•ï¼Œæˆ‘ä»¬å°† lex ç†è§£ä¸ºæ­£åˆ™åŒ¹é…çš„ç”Ÿæˆå™¨ï¼Œå®ƒä¼šä½¿ç”¨æ­£åˆ™åŒ¹é…æ‰«æè¾“å…¥çš„å­—ç¬¦æµï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª lex æ–‡ä»¶ `simplego.l` çš„ç¤ºä¾‹ï¼š

```c
%{
#include <stdio.h>
%}

%%
package      printf("PACKAGE ");
import       printf("IMPORT ");
\.           printf("DOT ");
\{           printf("LBRACE ");
\}           printf("RBRACE ");
\(           printf("LPAREN ");
\)           printf("RPAREN ");
\"           printf("QUOTE ");
\n           printf("\n");
[0-9]+       printf("NUMBER ");
[a-zA-Z_]+   printf("IDENT ");
%%
```

è¿™ä¸ªå®šä¹‰å¥½çš„æ–‡ä»¶èƒ½å¤Ÿè§£æ `package` å’Œ `import` å…³é”®å­—ã€å¸¸è§çš„ç‰¹æ®Šå­—ç¬¦ã€æ•°å­—ä»¥åŠæ ‡è¯†ç¬¦ï¼Œè™½ç„¶è¿™é‡Œçš„è§„åˆ™å¯èƒ½æœ‰ä¸€äº›ç®€é™‹å’Œä¸å®Œå–„ï¼Œä½†æ˜¯ç”¨æ¥è§£æä¸‹é¢çš„è¿™ä¸€æ®µä»£ç è¿˜æ˜¯æ¯”è¾ƒè½»æ¾çš„ï¼š

```go
package main

import (
	"fmt"
)

func main() {
	fmt.Println("Hello")
}
```

`.l` ç»“å°¾çš„ lex ä»£ç å¹¶ä¸èƒ½ç›´æ¥è¿è¡Œï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡ `lex` å‘½ä»¤å°†ä¸Šé¢çš„ `simplego.l` å±•å¼€æˆ C è¯­è¨€ä»£ç ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥æ‰§è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤ç¼–è¯‘å¹¶æ‰“å°æ–‡ä»¶ä¸­çš„å†…å®¹ï¼š

```c
$ lex simplego.l
$ cat lex.yy.c
...
int yylex (void) {
	...
	while ( 1 ) {
		...
yy_match:
		do {
			register YY_CHAR yy_c = yy_ec[YY_SC_TO_UI(*yy_cp)];
			if ( yy_accept[yy_current_state] ) {
				(yy_last_accepting_state) = yy_current_state;
				(yy_last_accepting_cpos) = yy_cp;
			}
			while ( yy_chk[yy_base[yy_current_state] + yy_c] != yy_current_state ) {
				yy_current_state = (int) yy_def[yy_current_state];
				if ( yy_current_state >= 30 )
					yy_c = yy_meta[(unsigned int) yy_c];
				}
			yy_current_state = yy_nxt[yy_base[yy_current_state] + (unsigned int) yy_c];
			++yy_cp;
		} while ( yy_base[yy_current_state] != 37 );
		...

do_action:
		switch ( yy_act )
			case 0:
    			...

			case 1:
    			YY_RULE_SETUP
    			printf("PACKAGE ");
    			YY_BREAK
			...
}
```

[lex.yy.c](https://gist.github.com/draveness/85db6ec4a4088b63ccccf7f09424f474)<sup>4</sup> çš„å‰ 600 è¡ŒåŸºæœ¬éƒ½æ˜¯å®å’Œå‡½æ•°çš„å£°æ˜å’Œå®šä¹‰ï¼Œåé¢ç”Ÿæˆçš„ä»£ç å¤§éƒ½æ˜¯ä¸º `yylex` è¿™ä¸ªå‡½æ•°æœåŠ¡çš„ï¼Œè¿™ä¸ªå‡½æ•°ä½¿ç”¨[æœ‰é™è‡ªåŠ¨æœºï¼ˆDeterministic Finite Automatonã€DFAï¼‰](https://en.wikipedia.org/wiki/Deterministic_finite_automaton)<sup>5</sup> çš„ç¨‹åºç»“æ„æ¥åˆ†æè¾“å…¥çš„å­—ç¬¦æµï¼Œä¸Šè¿°ä»£ç ä¸­ `while` å¾ªç¯å°±æ˜¯è¿™ä¸ªæœ‰é™è‡ªåŠ¨æœºçš„ä¸»ä½“ï¼Œä½ å¦‚æœä»”ç»†çœ‹è¿™ä¸ªæ–‡ä»¶ç”Ÿæˆçš„ä»£ç ä¼šå‘ç°å½“å‰çš„æ–‡ä»¶ä¸­å¹¶ä¸å­˜åœ¨ `main` å‡½æ•°ï¼Œ`main` å‡½æ•°æ˜¯åœ¨ liblex åº“ä¸­å®šä¹‰çš„ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å…¶å®éœ€è¦æ·»åŠ é¢å¤–çš„ `-ll` é€‰é¡¹ï¼š

```bash
$ cc lex.yy.c -o simplego -ll
$ cat main.go | ./simplego
```

å½“æˆ‘ä»¬å°† C è¯­è¨€ä»£ç é€šè¿‡ gcc ç¼–è¯‘æˆäºŒè¿›åˆ¶ä»£ç ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ç®¡é“å°†ä¸Šé¢æåˆ°çš„ Go è¯­è¨€ä»£ç ä½œä¸ºè¾“å…¥ä¼ é€’åˆ°ç”Ÿæˆçš„è¯æ³•åˆ†æå™¨ä¸­ï¼Œè¿™ä¸ªè¯æ³•åˆ†æå™¨ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„å†…å®¹ï¼š

```go
PACKAGE  IDENT

IMPORT  LPAREN
	QUOTE IDENT QUOTE
RPAREN

IDENT  IDENT LPAREN RPAREN  LBRACE
	IDENT DOT IDENT LPAREN QUOTE IDENT QUOTE RPAREN
RBRACE
```

ä»ä¸Šé¢çš„è¾“å‡ºæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ° Go æºä»£ç çš„å½±å­ï¼Œlex ç”Ÿæˆçš„è¯æ³•åˆ†æå™¨ lexer é€šè¿‡æ­£åˆ™åŒ¹é…çš„æ–¹å¼å°†æœºå™¨åŸæœ¬å¾ˆéš¾ç†è§£çš„å­—ç¬¦ä¸²è¿›è¡Œåˆ†è§£æˆå¾ˆå¤šçš„ Tokenï¼Œæœ‰åˆ©äºåé¢çš„å¤„ç†ã€‚

![simplego-lex](assets/2019-12-21-15769078788724-simplego-lex.png)

**å›¾ 2-7 ä» .l æ–‡ä»¶åˆ°äºŒè¿›åˆ¶**

åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»ä¸ºå„ä½è¯»è€…å±•ç¤ºäº†ä»å®šä¹‰ `.l` æ–‡ä»¶ã€ä½¿ç”¨ lex å°† `.l` æ–‡ä»¶ç¼–è¯‘æˆ C è¯­è¨€ä»£ç ä»¥åŠäºŒè¿›åˆ¶çš„å…¨è¿‡ç¨‹ï¼Œè€Œæœ€åç”Ÿæˆçš„è¯æ³•åˆ†æå™¨ä¹Ÿèƒ½å¤Ÿå°†ç®€å•çš„ Go è¯­è¨€ä»£ç è¿›è¡Œè½¬æ¢æˆ Token åºåˆ—ã€‚lex çš„ä½¿ç”¨è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå¿«é€Ÿå®ç°è¯æ³•åˆ†æå™¨ã€‚

### Go

Go è¯­è¨€çš„è¯æ³•è§£ææ˜¯é€šè¿‡ [`src/cmd/compile/internal/syntax/scanner.go`](https://github.com/golang/go/tree/master/src/cmd/compile/internal/syntax/scanner.go)<sup>6</sup> æ–‡ä»¶ä¸­çš„ [`cmd/compile/internal/syntax.scanner`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner) ç»“æ„ä½“å®ç°çš„ï¼Œè¿™ä¸ªç»“æ„ä½“ä¼šæŒæœ‰å½“å‰æ‰«æçš„æ•°æ®æºæ–‡ä»¶ã€å¯ç”¨çš„æ¨¡å¼å’Œå½“å‰è¢«æ‰«æåˆ°çš„ Tokenï¼š

```go
type scanner struct {
	source
	mode   uint
	nlsemi bool

	// current token, valid after calling next()
	line, col uint
	blank     bool // line is blank up to col
	tok       token
	lit       string   // valid if tok is _Name, _Literal, or _Semi ("semicolon", "newline", or "EOF"); may be malformed if bad is true
	bad       bool     // valid if tok is _Literal, true if a syntax error occurred, lit may be malformed
	kind      LitKind  // valid if tok is _Literal
	op        Operator // valid if tok is _Operator, _AssignOp, or _IncOp
	prec      int      // valid if tok is _Operator, _AssignOp, or _IncOp
}
```

[`src/cmd/compile/internal/syntax/tokens.go`](https://github.com/golang/go/tree/master/src/cmd/compile/internal/syntax/tokens.go)<sup>7</sup> æ–‡ä»¶ä¸­å®šä¹‰äº† Go è¯­è¨€ä¸­æ”¯æŒçš„å…¨éƒ¨ Token ç±»å‹ï¼Œæ‰€æœ‰çš„ `token` ç±»å‹éƒ½æ˜¯æ­£æ•´æ•°ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€äº›å¸¸è§ Token çš„å®šä¹‰ï¼Œä¾‹å¦‚ï¼šæ“ä½œç¬¦ã€æ‹¬å·å’Œå…³é”®å­—ç­‰ï¼š

```go
const (
	_    token = iota
	_EOF       // EOF

	// operators and operations
	_Operator // op
	...

	// delimiters
	_Lparen    // (
	_Lbrack    // [
	...

	// keywords
	_Break       // break
	...
	_Type        // type
	_Var         // var

	tokenCount //
)
```

ä» Go è¯­è¨€ä¸­å®šä¹‰çš„ Token ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯­è¨€ä¸­çš„å…ƒç´ åˆ†æˆå‡ ä¸ªä¸åŒçš„ç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯åç§°å’Œå­—é¢é‡ã€æ“ä½œç¬¦ã€åˆ†éš”ç¬¦å’Œå…³é”®å­—ã€‚è¯æ³•åˆ†æä¸»è¦æ˜¯ç”± [`cmd/compile/internal/syntax.scanner`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner) è¿™ä¸ªç»“æ„ä½“ä¸­çš„ [`cmd/compile/internal/syntax.scanner.next`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner.next) æ–¹æ³•é©±åŠ¨ï¼Œè¿™ä¸ª 250 è¡Œå‡½æ•°çš„ä¸»ä½“æ˜¯ä¸€ä¸ª `switch/case` ç»“æ„ï¼š

```go
func (s *scanner) next() {
	...
	s.stop()
	startLine, startCol := s.pos()
	for s.ch == ' ' || s.ch == '\t' || s.ch == '\n' && !nlsemi || s.ch == '\r' {
		s.nextch()
	}

	s.line, s.col = s.pos()
	s.blank = s.line > startLine || startCol == colbase
	s.start()
	if isLetter(s.ch) || s.ch >= utf8.RuneSelf && s.atIdentChar(true) {
		s.nextch()
		s.ident()
		return
	}

	switch s.ch {
	case -1:
		s.tok = _EOF

	case '0', '1', '2', '3', '4', '5', '6', '7', '8', '9':
		s.number(false)
	...
	}
}
```

[`cmd/compile/internal/syntax.scanner`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner) æ¯æ¬¡éƒ½ä¼šé€šè¿‡ [`cmd/compile/internal/syntax.source.nextch`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.source.nextch) å‡½æ•°è·å–æ–‡ä»¶ä¸­æœ€è¿‘çš„æœªè¢«è§£æçš„å­—ç¬¦ï¼Œç„¶åæ ¹æ®å½“å‰å­—ç¬¦çš„ä¸åŒæ‰§è¡Œä¸åŒçš„ caseï¼Œå¦‚æœé‡åˆ°äº†ç©ºæ ¼å’Œæ¢è¡Œç¬¦è¿™äº›ç©ºç™½å­—ç¬¦ä¼šç›´æ¥è·³è¿‡ï¼Œå¦‚æœå½“å‰å­—ç¬¦æ˜¯ 0 å°±ä¼šæ‰§è¡Œ [`cmd/compile/internal/syntax.scanner.number`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner.number) æ–¹æ³•å°è¯•åŒ¹é…ä¸€ä¸ªæ•°å­—ã€‚

```go
func (s *scanner) number(seenPoint bool) {
	kind := IntLit
	base := 10        // number base
	digsep := 0
	invalid := -1     // index of invalid digit in literal, or < 0

	s.kind = IntLit
	if !seenPoint {
		digsep |= s.digits(base, &invalid)
	}

	s.setLit(kind, ok)
}

func (s *scanner) digits(base int, invalid *int) (digsep int) {
	max := rune('0' + base)
	for isDecimal(s.ch) || s.ch == '_' {
		ds := 1
		if s.ch == '_' {
			ds = 2
		} else if s.ch >= max && *invalid < 0 {
			_, col := s.pos()
			*invalid = int(col - s.col) // record invalid rune index
		}
		digsep |= ds
		s.nextch()
	}
	return
}
```

ä¸Šè¿°çš„ [`cmd/compile/internal/syntax.scanner.number`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner.number) æ–¹æ³•çœç•¥äº†å¾ˆå¤šçš„ä»£ç ï¼ŒåŒ…æ‹¬å¦‚ä½•åŒ¹é…æµ®ç‚¹æ•°ã€æŒ‡æ•°å’Œå¤æ•°ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•çœ‹ä¸€ä¸‹è¯æ³•åˆ†æåŒ¹é…æ•´æ•°çš„é€»è¾‘ï¼šåœ¨ for å¾ªç¯ä¸­ä¸æ–­è·å–æœ€æ–°çš„å­—ç¬¦ï¼Œå°†å­—ç¬¦é€šè¿‡ [`cmd/compile/internal/syntax.source.nextch`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.source.nextch) æ–¹æ³•è¿½åŠ åˆ° [`cmd/compile/internal/syntax.scanner`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner) æŒæœ‰çš„ç¼“å†²åŒºä¸­ï¼›

å½“å‰åŒ…ä¸­çš„è¯æ³•åˆ†æå™¨ [`cmd/compile/internal/syntax.scanner`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner) ä¹Ÿåªæ˜¯ä¸ºä¸Šå±‚æä¾›äº† [`cmd/compile/internal/syntax.scanner.next`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner.next) æ–¹æ³•ï¼Œè¯æ³•è§£æçš„è¿‡ç¨‹éƒ½æ˜¯æƒ°æ€§çš„ï¼Œåªæœ‰åœ¨ä¸Šå±‚çš„è§£æå™¨éœ€è¦æ—¶æ‰ä¼šè°ƒç”¨ [`cmd/compile/internal/syntax.scanner.next`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner.next) è·å–æœ€æ–°çš„ Tokenã€‚

Go è¯­è¨€çš„è¯æ³•å…ƒç´ ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨è¿™ç§å·¨å¤§çš„ `switch/case` è¿›è¡Œè¯æ³•è§£æä¹Ÿæ¯”è¾ƒæ–¹ä¾¿å’Œé¡ºæ‰‹ï¼Œæ—©æœŸçš„ Go è¯­è¨€è™½ç„¶ä½¿ç”¨ lex è¿™ç§å·¥å…·æ¥ç”Ÿæˆè¯æ³•è§£æå™¨ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯ä½¿ç”¨ Go æ¥å®ç°è¯æ³•åˆ†æå™¨ï¼Œç”¨è‡ªå·±å†™çš„è¯æ³•åˆ†æå™¨æ¥è§£æè‡ªå·±<sup>8</sup>ã€‚

## 2.2.2 è¯­æ³•åˆ†æ

[è¯­æ³•åˆ†æ](https://en.wikipedia.org/wiki/Parsing)æ˜¯æ ¹æ®æŸç§ç‰¹å®šçš„å½¢å¼æ–‡æ³•ï¼ˆGrammarï¼‰å¯¹ Token åºåˆ—æ„æˆçš„è¾“å…¥æ–‡æœ¬è¿›è¡Œåˆ†æå¹¶ç¡®å®šå…¶è¯­æ³•ç»“æ„çš„è¿‡ç¨‹<sup>9</sup>ã€‚ä»ä¸Šé¢çš„å®šä¹‰æ¥çœ‹ï¼Œè¯æ³•åˆ†æå™¨è¾“å‡ºçš„ç»“æœï¼ˆToken åºåˆ—ï¼‰å³ä¸ºè¯­æ³•åˆ†æå™¨çš„è¾“å…¥ã€‚

è¯­æ³•åˆ†æçš„è¿‡ç¨‹ä¼šä½¿ç”¨è‡ªé¡¶å‘ä¸‹æˆ–è€…è‡ªåº•å‘ä¸Šçš„æ–¹å¼è¿›è¡Œæ¨å¯¼ï¼Œåœ¨ä»‹ç» Go è¯­è¨€è¯­æ³•åˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šå…ˆæ¥ä»‹ç»è¯­æ³•åˆ†æä¸­çš„æ–‡æ³•å’Œåˆ†ææ–¹æ³•ã€‚

### æ–‡æ³•

[ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•](https://en.wikipedia.org/wiki/Context-free_grammar)æ˜¯ç”¨æ¥å½¢å¼åŒ–ã€ç²¾ç¡®æè¿°æŸç§ç¼–ç¨‹è¯­è¨€çš„å·¥å…·ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æ–‡æ³•å®šä¹‰ä¸€ç§è¯­è¨€çš„è¯­æ³•ï¼Œå®ƒä¸»è¦åŒ…å«ä¸€ç³»åˆ—ç”¨äºè½¬æ¢å­—ç¬¦ä¸²çš„ç”Ÿäº§è§„åˆ™ï¼ˆProduction ruleï¼‰<sup>10</sup>ã€‚ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ä¸­çš„æ¯ä¸€ä¸ªç”Ÿäº§è§„åˆ™éƒ½ä¼šå°†è§„åˆ™å·¦ä¾§çš„éç»ˆç»“ç¬¦è½¬æ¢æˆå³ä¾§çš„å­—ç¬¦ä¸²ï¼Œæ–‡æ³•éƒ½ç”±ä»¥ä¸‹çš„å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š

- ğ‘ æœ‰é™ä¸ªéç»ˆç»“ç¬¦çš„é›†åˆï¼›
- Î£ æœ‰é™ä¸ªç»ˆç»“ç¬¦çš„é›†åˆï¼›
- ğ‘ƒ æœ‰é™ä¸ªç”Ÿäº§è§„åˆ™<sup>12</sup>çš„é›†åˆï¼›
- ğ‘† éç»ˆç»“ç¬¦é›†åˆä¸­å”¯ä¸€çš„å¼€å§‹ç¬¦å·ï¼›

> ç»ˆç»“ç¬¦æ˜¯æ–‡æ³•ä¸­æ— æ³•å†è¢«å±•å¼€çš„ç¬¦å·ï¼Œè€Œéç»ˆç»“ç¬¦ä¸ä¹‹ç›¸åï¼Œè¿˜å¯ä»¥é€šè¿‡ç”Ÿäº§è§„åˆ™è¿›è¡Œå±•å¼€ï¼Œä¾‹å¦‚ â€œidâ€ã€â€œ123â€ ç­‰æ ‡è¯†æˆ–è€…å­—é¢é‡<sup>11</sup>ã€‚

æ–‡æ³•è¢«å®šä¹‰æˆä¸€ä¸ªå››å…ƒç»„ (ğ‘,Î£,ğ‘ƒ,ğ‘†)ï¼Œè¿™ä¸ªå…ƒç»„ä¸­çš„å‡ éƒ¨åˆ†æ˜¯ä¸Šé¢æåˆ°çš„å››ä¸ªç¬¦å·ï¼Œå…¶ä¸­æœ€ä¸ºé‡è¦çš„å°±æ˜¯ç”Ÿäº§è§„åˆ™ï¼Œæ¯ä¸ªç”Ÿäº§è§„åˆ™éƒ½ä¼šåŒ…å«éç»ˆç»“ç¬¦ã€ç»ˆç»“ç¬¦æˆ–è€…å¼€å§‹ç¬¦å·ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š

1. ğ‘†â†’ğ‘ğ‘†ğ‘
2. ğ‘†â†’ğ‘ğ‘
3. ğ‘†â†’ğœ–

ä¸Šè¿°è§„åˆ™æ„æˆçš„æ–‡æ³•å°±èƒ½å¤Ÿè¡¨ç¤º abã€aabb ä»¥åŠ aaa..bbb ç­‰å­—ç¬¦ä¸²ï¼Œç¼–ç¨‹è¯­è¨€çš„æ–‡æ³•å°±æ˜¯ç”±è¿™ä¸€ç³»åˆ—çš„ç”Ÿäº§è§„åˆ™è¡¨ç¤ºçš„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä» [`src/cmd/compile/internal/syntax/parser.go`](https://github.com/golang/go/blob/master/src/cmd/compile/internal/syntax/parser.go)<sup>13</sup> æ–‡ä»¶ä¸­æ‘˜æŠ„ä¸€äº› Go è¯­è¨€æ–‡æ³•çš„ç”Ÿäº§è§„åˆ™ï¼š

```go
SourceFile = PackageClause ";" { ImportDecl ";" } { TopLevelDecl ";" } .
PackageClause  = "package" PackageName .
PackageName    = identifier .

ImportDecl       = "import" ( ImportSpec | "(" { ImportSpec ";" } ")" ) .
ImportSpec       = [ "." | PackageName ] ImportPath .
ImportPath       = string_lit .

TopLevelDecl  = Declaration | FunctionDecl | MethodDecl .
Declaration   = ConstDecl | TypeDecl | VarDecl .
```

> Go è¯­è¨€æ›´è¯¦ç»†çš„æ–‡æ³•å¯ä»¥ä» [Language Specification](https://golang.org/ref/spec)<sup>14</sup> ä¸­æ‰¾åˆ°ï¼Œè¿™é‡Œä¸ä»…åŒ…å«è¯­è¨€çš„æ–‡æ³•ï¼Œè¿˜åŒ…å«è¯æ³•å…ƒç´ ã€å†…ç½®å‡½æ•°ç­‰ä¿¡æ¯ã€‚

å› ä¸ºæ¯ä¸ª Go æºä»£ç æ–‡ä»¶æœ€ç»ˆéƒ½ä¼šè¢«è§£ææˆä¸€ä¸ªç‹¬ç«‹çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œæ‰€ä»¥è¯­æ³•æ ‘æœ€é¡¶å±‚çš„ç»“æ„æˆ–è€…å¼€å§‹ç¬¦å·éƒ½æ˜¯ SourceFileï¼š

```go
SourceFile = PackageClause ";" { ImportDecl ";" } { TopLevelDecl ";" } .
```

ä» SourceFile ç›¸å…³çš„ç”Ÿäº§è§„åˆ™æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶éƒ½åŒ…å«ä¸€ä¸ª `package` çš„å®šä¹‰ä»¥åŠå¯é€‰çš„ `import` å£°æ˜å’Œå…¶ä»–çš„é¡¶å±‚å£°æ˜ï¼ˆTopLevelDeclï¼‰ï¼Œæ¯ä¸€ä¸ª SourceFile åœ¨ç¼–è¯‘å™¨ä¸­éƒ½å¯¹åº”ä¸€ä¸ª [`cmd/compile/internal/syntax.File`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.File) ç»“æ„ä½“ï¼Œä½ èƒ½ä»å®ƒä»¬çš„å®šä¹‰ä¸­è½»æ¾æ‰¾åˆ°ä¸¤è€…çš„è”ç³»ï¼š

```go
type File struct {
	Pragma   Pragma
	PkgName  *Name
	DeclList []Decl
	Lines    uint
	node
}
```

é¡¶å±‚å£°æ˜æœ‰äº”å¤§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å¸¸é‡ã€ç±»å‹ã€å˜é‡ã€å‡½æ•°å’Œæ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨æ–‡ä»¶ [`src/cmd/compile/internal/syntax/parser.go`](https://github.com/golang/go/blob/master/src/cmd/compile/internal/syntax/parser.go) ä¸­æ‰¾åˆ°è¿™äº”å¤§ç±»å‹çš„å®šä¹‰ã€‚

```go
ConstDecl = "const" ( ConstSpec | "(" { ConstSpec ";" } ")" ) .
ConstSpec = IdentifierList [ [ Type ] "=" ExpressionList ] .

TypeDecl  = "type" ( TypeSpec | "(" { TypeSpec ";" } ")" ) .
TypeSpec  = AliasDecl | TypeDef .
AliasDecl = identifier "=" Type .
TypeDef   = identifier Type .

VarDecl = "var" ( VarSpec | "(" { VarSpec ";" } ")" ) .
VarSpec = IdentifierList ( Type [ "=" ExpressionList ] | "=" ExpressionList ) .
```

ä¸Šè¿°çš„æ–‡æ³•åˆ†åˆ«å®šä¹‰äº† Go è¯­è¨€ä¸­å¸¸é‡ã€ç±»å‹å’Œå˜é‡ä¸‰ç§å¸¸è§çš„ç»“æ„ï¼Œä»æ–‡æ³•ä¸­å¯ä»¥çœ‹åˆ°è¯­è¨€ä¸­çš„å¾ˆå¤šå…³é”®å­— `const`ã€`type` å’Œ `var`ï¼Œç¨å¾®å›æƒ³ä¸€ä¸‹æˆ‘ä»¬æ—¥å¸¸æ¥è§¦çš„ Go è¯­è¨€ä»£ç å°±èƒ½éªŒè¯è¿™é‡Œæ–‡æ³•çš„æ­£ç¡®æ€§ã€‚

é™¤äº†ä¸‰ç§ç®€å•çš„è¯­æ³•ç»“æ„ä¹‹å¤–ï¼Œå‡½æ•°å’Œæ–¹æ³•çš„å®šä¹‰å°±æ›´åŠ å¤æ‚ï¼Œä»ä¸‹é¢çš„æ–‡æ³•æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Statement æ€»å…±å¯ä»¥è½¬æ¢æˆ 15 ç§ä¸åŒçš„è¯­æ³•ç»“æ„ï¼Œè¿™äº›è¯­æ³•ç»“æ„å°±åŒ…æ‹¬æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ switch/caseã€if/elseã€for å¾ªç¯ä»¥åŠ select ç­‰è¯­å¥ï¼š

```go
FunctionDecl = "func" FunctionName Signature [ FunctionBody ] .
FunctionName = identifier .
FunctionBody = Block .

MethodDecl = "func" Receiver MethodName Signature [ FunctionBody ] .
Receiver   = Parameters .

Block = "{" StatementList "}" .
StatementList = { Statement ";" } .

Statement =
	Declaration | LabeledStmt | SimpleStmt |
	GoStmt | ReturnStmt | BreakStmt | ContinueStmt | GotoStmt |
	FallthroughStmt | Block | IfStmt | SwitchStmt | SelectStmt | ForStmt |
	DeferStmt .

SimpleStmt = EmptyStmt | ExpressionStmt | SendStmt | IncDecStmt | Assignment | ShortVarDecl .
```

è¿™äº›ä¸åŒçš„è¯­æ³•ç»“æ„å…±åŒå®šä¹‰äº† Go è¯­è¨€ä¸­èƒ½å¤Ÿä½¿ç”¨çš„è¯­æ³•ç»“æ„å’Œè¡¨è¾¾å¼ï¼Œå¯¹äº Statement å±•å¼€çš„æ›´å¤šå†…å®¹è¿™ç¯‡æ–‡ç« å°±ä¸ä¼šè¯¦ç»†ä»‹ç»äº†ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ç›´æ¥æŸ¥çœ‹ [Go è¯­è¨€è¯´æ˜ä¹¦](https://golang.org/ref/spec#Statement)æˆ–è€…ç›´æ¥ä» [`src/cmd/compile/internal/syntax/parser.go`](https://github.com/golang/go/blob/master/src/cmd/compile/internal/syntax/parser.go) æ–‡ä»¶ä¸­æ‰¾åˆ°æƒ³è¦çš„ç­”æ¡ˆã€‚

### åˆ†ææ–¹æ³•

è¯­æ³•åˆ†æçš„åˆ†ææ–¹æ³•ä¸€èˆ¬åˆ†ä¸ºè‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•å‘ä¸Šä¸¤ç§ï¼Œè¿™ä¸¤ç§æ–¹å¼ä¼šä½¿ç”¨ä¸åŒçš„æ–¹å¼å¯¹è¾“å…¥çš„ Token åºåˆ—è¿›è¡Œæ¨å¯¼ï¼š

- [è‡ªé¡¶å‘ä¸‹åˆ†æ](https://en.wikipedia.org/wiki/Top-down_parsing)ï¼šå¯ä»¥è¢«çœ‹ä½œæ‰¾åˆ°å½“å‰è¾“å…¥æµæœ€å·¦æ¨å¯¼çš„è¿‡ç¨‹ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªè¾“å…¥æµï¼Œæ ¹æ®å½“å‰çš„è¾“å…¥ç¬¦å·ï¼Œç¡®å®šä¸€ä¸ªç”Ÿäº§è§„åˆ™ï¼Œä½¿ç”¨ç”Ÿäº§è§„åˆ™å³ä¾§çš„ç¬¦å·æ›¿ä»£ç›¸åº”çš„éç»ˆç»“ç¬¦å‘ä¸‹æ¨å¯¼<sup>15</sup>
- [è‡ªåº•å‘ä¸Šåˆ†æ](https://en.wikipedia.org/wiki/Bottom-up_parsing)ï¼šè¯­æ³•åˆ†æå™¨ä»è¾“å…¥æµå¼€å§‹ï¼Œæ¯æ¬¡éƒ½å°è¯•é‡å†™æœ€å³ä¾§çš„å¤šä¸ªç¬¦å·ï¼Œè¿™å…¶å®æ˜¯è¯´è§£æå™¨ä¼šä»æœ€ç®€å•çš„ç¬¦å·è¿›è¡Œæ¨å¯¼ï¼Œåœ¨è§£æçš„æœ€ååˆå¹¶æˆå¼€å§‹ç¬¦å·<sup>16</sup>

#### è‡ªé¡¶å‘ä¸‹ 

[LL æ–‡æ³•](https://en.wikipedia.org/wiki/LL_grammar)<sup>17</sup>æ˜¯ä¸€ç§ä½¿ç”¨è‡ªé¡¶å‘ä¸‹åˆ†ææ–¹æ³•çš„æ–‡æ³•ï¼Œä¸‹é¢ç»™å‡ºäº†ä¸€ä¸ªå¸¸è§çš„ LL æ–‡æ³•ï¼š

1. ğ‘†â†’ğ‘ğ‘†1
2. ğ‘†1â†’ğ‘ğ‘†1
3. ğ‘†1â†’ğœ–

å‡è®¾æˆ‘ä»¬å­˜åœ¨ä»¥ä¸Šçš„ç”Ÿäº§è§„åˆ™å’Œè¾“å…¥æµ abbï¼Œå¦‚æœè¿™é‡Œä½¿ç”¨è‡ªé¡¶å‘ä¸‹çš„æ–¹å¼è¿›è¡Œè¯­æ³•åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ¯æ¬¡è§£æå™¨ä¼šé€šè¿‡æ–°åŠ å…¥çš„å­—ç¬¦åˆ¤æ–­åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å±•å¼€å½“å‰çš„è¾“å…¥æµï¼š

1. ğ‘† ï¼ˆå¼€å§‹ç¬¦å·ï¼‰
2. ğ‘ğ‘†1ï¼ˆè§„åˆ™ 1)
3. ğ‘ğ‘ğ‘†1ï¼ˆè§„åˆ™ 2)
4. ğ‘ğ‘ğ‘ğ‘†1ï¼ˆè§„åˆ™ 2)
5. ğ‘ğ‘ğ‘ï¼ˆè§„åˆ™ 3)

è¿™ç§åˆ†ææ–¹æ³•ä¸€å®šä¼šä»å¼€å§‹ç¬¦å·åˆ†æï¼Œé€šè¿‡ä¸‹ä¸€ä¸ªå³å°†å…¥æ ˆçš„ç¬¦å·åˆ¤æ–­åº”è¯¥å¦‚ä½•å¯¹å½“å‰å †æ ˆä¸­æœ€å³ä¾§çš„éç»ˆç»“ç¬¦ï¼ˆğ‘† æˆ– ğ‘†1ï¼‰è¿›è¡Œå±•å¼€ï¼Œç›´åˆ°æ•´ä¸ªå­—ç¬¦ä¸²ä¸­ä¸å­˜åœ¨ä»»ä½•çš„éç»ˆç»“ç¬¦ï¼Œæ•´ä¸ªè§£æè¿‡ç¨‹æ‰ä¼šç»“æŸã€‚

#### è‡ªåº•å‘ä¸Š

ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨è‡ªåº•å‘ä¸Šçš„æ–¹å¼å¯¹è¾“å…¥æµè¿›è¡Œåˆ†ææ—¶ï¼Œå¤„ç†è¿‡ç¨‹å°±ä¼šå®Œå…¨ä¸åŒäº†ï¼Œå¸¸è§çš„å››ç§æ–‡æ³• LR(0)ã€SLRã€LR(1) å’Œ LALR(1) ä½¿ç”¨äº†è‡ªåº•å‘ä¸Šçš„å¤„ç†æ–¹å¼<sup>18</sup>ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•å†™ä¸€ä¸ªä¸ä¸Šä¸€èŠ‚ä¸­æ•ˆæœç›¸åŒçš„ LR(0) æ–‡æ³•ï¼š

1. ğ‘†â†’ğ‘†1
2. ğ‘†1â†’ğ‘†1ğ‘
3. ğ‘†1â†’ğ‘

ä½¿ç”¨ä¸Šè¿°ç­‰æ•ˆçš„æ–‡æ³•å¤„ç†åŒæ ·åœ°è¾“å…¥æµ abb ä¼šä½¿ç”¨å®Œå…¨ä¸åŒçš„è¿‡ç¨‹å¯¹è¾“å…¥æµè¿›è¡Œå±•å¼€ï¼š

1. ğ‘aï¼ˆå…¥æ ˆï¼‰
2. ğ‘†1ï¼ˆè§„åˆ™ 3ï¼‰
3. ğ‘†1ğ‘ï¼ˆå…¥æ ˆï¼‰
4. ğ‘†1ï¼ˆè§„åˆ™ 2ï¼‰
5. ğ‘†1ğ‘ï¼ˆå…¥æ ˆï¼‰
6. ğ‘†1ï¼ˆè§„åˆ™ 2ï¼‰
7. ğ‘†ï¼ˆè§„åˆ™ 1ï¼‰

è‡ªåº•å‘ä¸Šçš„åˆ†æè¿‡ç¨‹ä¼šç»´æŠ¤ä¸€ä¸ªæ ˆç”¨äºå­˜å‚¨æœªè¢«å½’çº¦çš„ç¬¦å·ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œä¸¤ç§ä¸åŒçš„æ“ä½œï¼Œä¸€ç§å«åšå…¥æ ˆï¼ˆShiftï¼‰ï¼Œä¹Ÿå°±æ˜¯å°†ä¸‹ä¸€ä¸ªç¬¦å·å…¥æ ˆï¼Œå¦ä¸€ç§å«åšå½’çº¦ï¼ˆReduceï¼‰ï¼Œä¹Ÿå°±æ˜¯å¯¹æœ€å³ä¾§çš„å­—ç¬¦ä¸²æŒ‰ç…§ç”Ÿäº§è§„åˆ™è¿›è¡Œåˆå¹¶ã€‚

ä¸Šè¿°çš„åˆ†æè¿‡ç¨‹å’Œè‡ªé¡¶å‘ä¸‹çš„åˆ†ææ–¹æ³•å®Œå…¨ä¸åŒï¼Œè¿™ä¸¤ç§ä¸åŒçš„åˆ†ææ–¹æ³•å…¶å®ä¹Ÿä»£è¡¨äº†è®¡ç®—æœºç§‘å­¦ä¸­ä¸¤ç§ä¸åŒçš„æ€æƒ³ â€” ä»æŠ½è±¡åˆ°å…·ä½“å’Œä»å…·ä½“åˆ°æŠ½è±¡ã€‚

#### Lookahead

åœ¨è¯­æ³•åˆ†æä¸­é™¤äº† LL å’Œ LR è¿™ä¸¤ç§ä¸åŒç±»å‹çš„è¯­æ³•åˆ†ææ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å¦ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå°±æ˜¯[å‘å‰æŸ¥çœ‹ï¼ˆLookaheadï¼‰](https://en.wikipedia.org/wiki/Lookahead)ï¼Œåœ¨ä¸åŒç”Ÿäº§è§„åˆ™å‘ç”Ÿå†²çªæ—¶ï¼Œå½“å‰è§£æå™¨éœ€è¦é€šè¿‡é¢„è¯»ä¸€äº› Token åˆ¤æ–­å½“å‰åº”è¯¥ç”¨ä»€ä¹ˆç”Ÿäº§è§„åˆ™å¯¹è¾“å…¥æµè¿›è¡Œå±•å¼€æˆ–è€…å½’çº¦<sup>19</sup>ï¼Œä¾‹å¦‚åœ¨ LALR(1) æ–‡æ³•ä¸­ï¼Œéœ€è¦é¢„è¯»ä¸€ä¸ª Token ä¿è¯å‡ºç°å†²çªçš„ç”Ÿäº§è§„åˆ™èƒ½å¤Ÿè¢«æ­£ç¡®å¤„ç†ã€‚

### Go

Go è¯­è¨€çš„è§£æå™¨ä½¿ç”¨äº† LALR(1) çš„æ–‡æ³•æ¥è§£æè¯æ³•åˆ†æè¿‡ç¨‹ä¸­è¾“å‡ºçš„ Token åºåˆ—<sup>20</sup>ï¼Œæœ€å³æ¨å¯¼åŠ å‘å‰æŸ¥çœ‹æ„æˆäº† Go è¯­è¨€è§£æå™¨çš„æœ€åŸºæœ¬åŸç†ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€çš„é€‰æ‹©ã€‚

æˆ‘ä»¬åœ¨[æ¦‚è¿°](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/)ä¸­å·²ç»ä»‹ç»äº†ç¼–è¯‘å™¨çš„ä¸»å‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨çš„ [`cmd/compile/internal/gc.parseFiles`](https://draveness.me/golang/tree/cmd/compile/internal/gc.parseFiles) ä¼šä½¿ç”¨å¤šä¸ª Goroutine æ¥è§£ææºæ–‡ä»¶ï¼Œè§£æçš„è¿‡ç¨‹ä¼šè°ƒç”¨ [`cmd/compile/internal/syntax.Parse`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.Parse)ï¼Œè¯¥å‡½æ•°åˆå§‹åŒ–äº†ä¸€ä¸ªæ–°çš„ [`cmd/compile/internal/syntax.parser`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser) ç»“æ„ä½“å¹¶é€šè¿‡ [`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil) æ–¹æ³•å¼€å¯å¯¹å½“å‰æ–‡ä»¶çš„è¯æ³•å’Œè¯­æ³•è§£æï¼š

```go
func Parse(base *PosBase, src io.Reader, errh ErrorHandler, pragh PragmaHandler, mode Mode) (_ *File, first error) {
	var p parser
	p.init(base, src, errh, pragh, mode)
	p.next()
	return p.fileOrNil(), p.first
}
```

[`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil) æ–¹æ³•å…¶å®æ˜¯å¯¹ä¸Šé¢ä»‹ç»çš„ Go è¯­è¨€æ–‡æ³•çš„å®ç°ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä¼šè§£ææ–‡ä»¶å¼€å¤´çš„ `package` å®šä¹‰ï¼š

```go
// SourceFile = PackageClause ";" { ImportDecl ";" } { TopLevelDecl ";" } .
func (p *parser) fileOrNil() *File {
	f := new(File)
	f.pos = p.pos()

	if !p.got(_Package) {
		p.syntaxError("package statement must be first")
		return nil
	}
	f.PkgName = p.name()
	p.want(_Semi)
```

ä»ä¸Šé¢çš„è¿™ä¸€æ®µæ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“å‰æ–¹æ³•ä¼šé€šè¿‡ [`cmd/compile/internal/syntax.parser.got`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.got) æ¥åˆ¤æ–­ä¸‹ä¸€ä¸ª Token æ˜¯ä¸æ˜¯ `package` å…³é”®å­—ï¼Œå¦‚æœæ˜¯ `package` å…³é”®å­—ï¼Œå°±ä¼šæ‰§è¡Œ [`cmd/compile/internal/syntax.parser.name`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.name) æ¥åŒ¹é…ä¸€ä¸ªåŒ…åå¹¶å°†ç»“æœä¿å­˜åˆ°è¿”å›çš„æ–‡ä»¶ç»“æ„ä½“ä¸­ã€‚

```go
for p.got(_Import) {
	f.DeclList = p.appendGroup(f.DeclList, p.importDecl)
	p.want(_Semi)
}
```

ç¡®å®šäº†å½“å‰æ–‡ä»¶çš„åŒ…åä¹‹åï¼Œå°±å¼€å§‹è§£æå¯é€‰çš„ `import` å£°æ˜ï¼Œæ¯ä¸€ä¸ª `import` åœ¨è§£æå™¨çœ‹æ¥éƒ½æ˜¯ä¸€ä¸ªå£°æ˜è¯­å¥ï¼Œè¿™äº›å£°æ˜è¯­å¥éƒ½ä¼šè¢«åŠ å…¥åˆ°æ–‡ä»¶çš„ `DeclList` ä¸­ã€‚

åœ¨è¿™ä¹‹åä¼šæ ¹æ®ç¼–è¯‘å™¨è·å–çš„å…³é”®å­—è¿›å…¥ switch çš„ä¸åŒåˆ†æ”¯ï¼Œè¿™äº›åˆ†æ”¯è°ƒç”¨ [`cmd/compile/internal/syntax.parser.appendGroup`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.appendGroup) æ–¹æ³•å¹¶åœ¨æ–¹æ³•ä¸­ä¼ å…¥ç”¨äºå¤„ç†å¯¹åº”ç±»å‹è¯­å¥çš„ [`cmd/compile/internal/syntax.parser.constDecl`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.constDecl)ã€[`cmd/compile/internal/syntax.parser.typeDecl`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.typeDecl) å‡½æ•°ã€‚

```go
	for p.tok != _EOF {
		switch p.tok {
		case _Const:
			p.next()
			f.DeclList = p.appendGroup(f.DeclList, p.constDecl)

		case _Type:
			p.next()
			f.DeclList = p.appendGroup(f.DeclList, p.typeDecl)

		case _Var:
			p.next()
			f.DeclList = p.appendGroup(f.DeclList, p.varDecl)

		case _Func:
			p.next()
			if d := p.funcDeclOrNil(); d != nil {
				f.DeclList = append(f.DeclList, d)
			}
		default:
			...
		}
	}

	f.Lines = p.source.line

	return f
}
```

[`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil) ä½¿ç”¨äº†éå¸¸å¤šçš„å­æ–¹æ³•å¯¹è¾“å…¥çš„æ–‡ä»¶è¿›è¡Œè¯­æ³•åˆ†æï¼Œå¹¶åœ¨æœ€åä¼šè¿”å›æ–‡ä»¶å¼€å§‹åˆ›å»ºçš„ [`cmd/compile/internal/syntax.File`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.File) ç»“æ„ä½“ã€‚

è¯»åˆ°è¿™é‡Œçš„äººå¯èƒ½ä¼šæœ‰ä¸€äº›ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°è¯æ³•åˆ†æçš„ä»£ç ï¼Œè¿™æ˜¯å› ä¸ºè¯æ³•åˆ†æå™¨ [`cmd/compile/internal/syntax.scanner`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner) ä½œä¸ºç»“æ„ä½“è¢«åµŒå…¥åˆ°äº† [`cmd/compile/internal/syntax.parser`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser) ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸­çš„ `p.next()` å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ [`cmd/compile/internal/syntax.scanner.next`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.scanner.next) æ–¹æ³•ï¼Œå®ƒä¼šç›´æ¥è·å–æ–‡ä»¶ä¸­çš„ä¸‹ä¸€ä¸ª Tokenï¼Œæ‰€ä»¥è¯æ³•å’Œè¯­æ³•åˆ†æä¸€èµ·è¿›è¡Œçš„ã€‚

[`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil) ä¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œçš„å…¶ä»–å­æ–¹æ³•å…±åŒæ„æˆäº†ä¸€æ£µæ ‘ï¼Œè¿™æ£µæ ‘æ ¹èŠ‚ç‚¹æ˜¯ [`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil)ï¼Œå­èŠ‚ç‚¹æ˜¯ [`cmd/compile/internal/syntax.parser.importDecl`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.importDecl)ã€[`cmd/compile/internal/syntax.parser.constDecl`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.constDecl) ç­‰æ–¹æ³•ï¼Œå®ƒä»¬ä¸ Go è¯­è¨€æ–‡æ³•ä¸­çš„ç”Ÿäº§è§„åˆ™ä¸€ä¸€å¯¹åº”ã€‚

![golang-parse](assets/2019-12-21-15769078928092-golang-parser.png)

**å›¾ 2-8 Go è¯­è¨€è§£æå™¨çš„æ–¹æ³•**

[`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil)ã€[`cmd/compile/internal/syntax.parser.constDecl`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.constDecl) ç­‰æ–¹æ³•å¯¹åº”äº† Go è¯­è¨€ä¸­çš„ç”Ÿäº§è§„åˆ™ï¼Œä¾‹å¦‚ [`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil) å®ç°çš„æ˜¯ï¼š

```go
SourceFile = PackageClause ";" { ImportDecl ";" } { TopLevelDecl ";" } .
```

æˆ‘ä»¬æ ¹æ®è¿™ä¸ªè§„åˆ™èƒ½å¾ˆå¥½åœ°ç†è§£è¯­æ³•åˆ†æå™¨çš„å®ç°åŸç† - å°†ç¼–ç¨‹è¯­è¨€çš„æ‰€æœ‰ç”Ÿäº§è§„åˆ™æ˜ å°„åˆ°å¯¹åº”çš„æ–¹æ³•ä¸Šï¼Œè¿™äº›æ–¹æ³•æ„æˆçš„æ ‘å½¢ç»“æ„æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚

å› ä¸ºå¤§å¤šæ•°æ–¹æ³•çš„å®ç°éƒ½éå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»…ä»‹ç» [`cmd/compile/internal/syntax.parser.fileOrNil`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.fileOrNil) æ–¹æ³•çš„å®ç°äº†ï¼Œæƒ³è¦äº†è§£å…¶ä»–æ–¹æ³•çš„å®ç°åŸç†ï¼Œè¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ [`src/cmd/compile/internal/syntax/parser.go`](https://github.com/golang/go/blob/master/src/cmd/compile/internal/syntax/parser.go) æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†è¯­æ³•åˆ†æé˜¶æ®µçš„å…¨éƒ¨æ–¹æ³•ã€‚

#### è¾…åŠ©æ–¹æ³•

è™½ç„¶è¿™é‡Œä¸ä¼šå±•å¼€ä»‹ç»å…¶ä»–ç±»ä¼¼æ–¹æ³•çš„å®ç°ï¼Œä½†æ˜¯è§£æå™¨è¿è¡Œè¿‡ç¨‹ä¸­æœ‰å‡ ä¸ªè¾…åŠ©æ–¹æ³•æˆ‘ä»¬è¿˜æ˜¯è¦ç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œé¦–å…ˆå°±æ˜¯ [`cmd/compile/internal/syntax.parser.got`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.got) å’Œ [`cmd/compile/internal/syntax.parser.want`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.want) è¿™ä¸¤ä¸ªå¸¸è§çš„æ–¹æ³•ï¼š

```go
func (p *parser) got(tok token) bool {
	if p.tok == tok {
		p.next()
		return true
	}
	return false
}

func (p *parser) want(tok token) {
	if !p.got(tok) {
		p.syntaxError("expecting " + tokstring(tok))
		p.advance()
	}
}
```

[`cmd/compile/internal/syntax.parser.got`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.got) åªæ˜¯ç”¨äºå¿«é€Ÿåˆ¤æ–­ä¸€äº›è¯­å¥ä¸­çš„å…³é”®å­—ï¼Œå¦‚æœå½“å‰è§£æå™¨ä¸­çš„ Token æ˜¯ä¼ å…¥çš„ Token å°±ä¼šç›´æ¥è·³è¿‡è¯¥ Token å¹¶è¿”å› `true`ï¼›è€Œ [`cmd/compile/internal/syntax.parser.want`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.want) å°±æ˜¯å¯¹ [`cmd/compile/internal/syntax.parser.got`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.got) çš„ç®€å•å°è£…äº†ï¼Œå¦‚æœå½“å‰ Token ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œå°±ä¼šç«‹åˆ»è¿”å›è¯­æ³•é”™è¯¯å¹¶ç»“æŸè¿™æ¬¡ç¼–è¯‘ã€‚

è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¼•å…¥èƒ½å¤Ÿå¸®åŠ©å·¥ç¨‹å¸ˆåœ¨ä¸Šå±‚å‡å°‘åˆ¤æ–­å…³é”®å­—çš„å¤§é‡é‡å¤é€»è¾‘ï¼Œè®©ä¸Šå±‚è¯­æ³•åˆ†æè¿‡ç¨‹çš„å®ç°æ›´åŠ æ¸…æ™°ã€‚

å¦ä¸€ä¸ªæ–¹æ³• [`cmd/compile/internal/synctax.parser.appendGroup`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.appendGroup) çš„å®ç°å°±ç¨å¾®å¤æ‚äº†ä¸€ç‚¹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯æ‰¾å‡ºæ‰¹é‡çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•ä¸¾ä¸€ä¸ªä¾‹å­ï¼š

```go
var (
   a int
   b int
)
```

è¿™ä¸¤ä¸ªå˜é‡å…¶å®å±äºåŒä¸€ä¸ªç»„ï¼ˆGroupï¼‰ï¼Œå„ç§é¡¶å±‚å®šä¹‰çš„ç»“æ„ä½“ [`cmd/compile/internal/syntax.parser.constDecl`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.constDecl)ã€[`cmd/compile/internal/syntax.parser.varDecl`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.varDecl) åœ¨è¿›è¡Œè¯­æ³•åˆ†ææ—¶æœ‰ä¸€ä¸ªé¢å¤–çš„å‚æ•° [`cmd/compile/internal/syntax.Group`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.Group)ï¼Œè¿™ä¸ªå‚æ•°æ˜¯é€šè¿‡ [`cmd/compile/internal/syntax.parser.appendGroup`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.appendGroup) æ–¹æ³•ä¼ é€’è¿›å»çš„ï¼š

```go
func (p *parser) appendGroup(list []Decl, f func(*Group) Decl) []Decl {
	if p.tok == _Lparen {
		g := new(Group)
		p.list(_Lparen, _Semi, _Rparen, func() bool {
			list = append(list, f(g))
			return false
		})
	} else {
		list = append(list, f(nil))
	}

	return list
}
```

[`cmd/compile/internal/syntax.parser.appendGroup`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.appendGroup) æ–¹æ³•ä¼šè°ƒç”¨ä¼ å…¥çš„ `f` æ–¹æ³•å¯¹è¾“å…¥æµè¿›è¡ŒåŒ¹é…å¹¶å°†åŒ¹é…çš„ç»“æœè¿½åŠ åˆ°å¦ä¸€ä¸ªå‚æ•° [`cmd/compile/internal/syntax.File`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.File) ç»“æ„ä½“ä¸­çš„ `DeclList` æ•°ç»„ä¸­ï¼Œ`import`ã€`const`ã€`var`ã€`type` å’Œ `func` å£°æ˜è¯­å¥éƒ½æ˜¯è°ƒç”¨ [`cmd/compile/internal/syntax.parser.appendGroup`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.parser.appendGroup) æ–¹æ³•è§£æçš„ã€‚

#### èŠ‚ç‚¹

è¯­æ³•åˆ†æå™¨æœ€ç»ˆä¼šä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“æ¥æ„å»ºæŠ½è±¡è¯­æ³•æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œå…¶ä¸­æ ¹èŠ‚ç‚¹ [`cmd/compile/internal/syntax.File`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.File) æˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢ä»‹ç»è¿‡äº†ï¼Œå…¶ä¸­åŒ…å«äº†å½“å‰æ–‡ä»¶çš„åŒ…åã€æ‰€æœ‰å£°æ˜ç»“æ„çš„åˆ—è¡¨å’Œæ–‡ä»¶çš„è¡Œæ•°ï¼š

```go
type File struct {
	Pragma   Pragma
	PkgName  *Name
	DeclList []Decl
	Lines    uint
	node
}
```

[`src/cmd/compile/internal/syntax/nodes.go`](https://github.com/golang/go/blob/master/src/cmd/compile/internal/syntax/nodes.go) æ–‡ä»¶ä¸­ä¹Ÿå®šä¹‰äº†å…¶ä»–èŠ‚ç‚¹çš„ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«å…¨éƒ¨å£°æ˜ç±»å‹çš„ï¼Œè¿™é‡Œç®€å•çœ‹ä¸€ä¸‹å‡½æ•°å£°æ˜çš„ç»“æ„ï¼š

```go
type (
	Decl interface {
		Node
		aDecl()
	}

	FuncDecl struct {
		Attr   map[string]bool
		Recv   *Field     // æ¥å—è€…
		Name   *Name      // å‡½æ•°å
		Type   *FuncType  // å‡½æ•°ç±»å‹
		Body   *BlockStmt // å‡½æ•°ä½“
		Pragma Pragma
		decl
	}
}
```

ä»å‡½æ•°å®šä¹‰ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå‡½æ•°åœ¨è¯­æ³•ç»“æ„ä¸Šä¸»è¦ç”±æ¥å—è€…ã€å‡½æ•°åã€å‡½æ•°ç±»å‹å’Œå‡½æ•°ä½“å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå‡½æ•°ä½“ [`cmd/compile/internal/syntax.BlockStmt`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.BlockStmt) æ˜¯ç”±ä¸€ç³»åˆ—çš„è¡¨è¾¾å¼ç»„æˆçš„ï¼Œè¿™äº›è¡¨è¾¾å¼å…±åŒç»„æˆäº†å‡½æ•°çš„ä¸»ä½“ï¼š

![golang-funcdecl-struct](assets/2019-12-21-15769078928100-golang-funcdecl-struct.png)

**å›¾ 2-9 Go è¯­è¨€å‡½æ•°å®šä¹‰çš„ç»“æ„ä½“**

å‡½æ•°çš„ä¸»ä½“å…¶å®æ˜¯ä¸€ä¸ª [`cmd/compile/internal/syntax.Stmt`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.Stmt) æ•°ç»„ï¼Œ[`cmd/compile/internal/syntax.Stmt`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.Stmt) æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°è¯¥æ¥å£çš„ç±»å‹å…¶å®ä¹Ÿéå¸¸å¤šï¼Œæ€»å…±æœ‰ 14 ç§ä¸åŒç±»å‹çš„ [`cmd/compile/internal/syntax.Stmt`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.Stmt) å®ç°ï¼š

![golang-statement](assets/2019-12-21-15769078928107-golang-statement.png)

**å›¾ 2-9 Go è¯­è¨€çš„ 14 ç§å£°æ˜**

è¿™äº›ä¸åŒç±»å‹çš„ [`cmd/compile/internal/syntax.Stmt`](https://draveness.me/golang/tree/cmd/compile/internal/syntax.Stmt) æ„æˆäº†å…¨éƒ¨å‘½ä»¤å¼çš„ Go è¯­è¨€ä»£ç ï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šç†Ÿæ‚‰çš„æ§åˆ¶ç»“æ„ï¼Œä¾‹å¦‚ ifã€forã€switch å’Œ selectï¼Œè¿™äº›å‘½ä»¤å¼çš„ç»“æ„åœ¨å…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿéå¸¸å¸¸è§ã€‚

## 2.2.4 å»¶ä¼¸é˜…è¯»

- [Lexical Scanning in Go - Rob Pike](https://www.youtube.com/watch?v=HxaD_trXwRE)

------

1. é€šç”¨ç¼–ç¨‹è¯­è¨€ General-purpose programming language https://en.wikipedia.org/wiki/General-purpose_programming_language [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:1)
2. è¯æ³•åˆ†æ Lexical analysis https://en.wikipedia.org/wiki/Lexical_analysis [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:2)
3. è¯æ³•åˆ†æç”Ÿæˆå™¨ http://dinosaur.compilertools.net/lex/index.html [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:3)
4. ç”Ÿæˆçš„ simplego.lex.c æ–‡ä»¶ https://gist.github.com/draveness/85db6ec4a4088b63ccccf7f09424f474 [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:4)
5. æœ‰é™è‡ªåŠ¨æœº DFA https://en.wikipedia.org/wiki/Deterministic_finite_automaton [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:5)
6. https://github.com/golang/go/tree/master/src/cmd/compile/internal/syntax/scanner.go [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:6)
7. https://github.com/golang/go/tree/master/src/cmd/compile/internal/syntax/tokens.go [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:7)
8. Go 1.5 Bootstrap Plan https://docs.google.com/document/d/1OaatvGhEAq7VseQ9kkavxKNAfepWy2yhPUBs96FGV28/edit [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:8)
9. è¯­æ³•åˆ†æ Syntactic analysis https://en.wikipedia.org/wiki/Parsing [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:9)
10. https://en.wikipedia.org/wiki/Context-free_grammar [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:10)
11. ç»ˆç»“ç¬¦å’Œéç»ˆç»“ç¬¦ https://en.wikipedia.org/wiki/Terminal_and_nonterminal_symbols [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:11)
12. ç”Ÿäº§è§„åˆ™åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸæ˜¯ç¬¦å·æ›¿æ¢çš„é‡å†™è§„åˆ™ï¼ŒS -> aSb å°±æ˜¯å¯ä»¥ç”¨å³ä¾§çš„ aSb å°†å·¦ä¾§çš„ç¬¦å·è¿›è¡Œå±•å¼€ https://en.wikipedia.org/wiki/Production_(computer_science) [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:12)
13. https://github.com/golang/go/blob/master/src/cmd/compile/internal/syntax/parser.go [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:13)
14. The Go Programming Language Specification https://golang.org/ref/spec [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:14)
15. è‡ªé¡¶å‘ä¸‹è§£æ https://en.wikipedia.org/wiki/Top-down_parsing [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:15)
16. è‡ªåº•å‘ä¸Šè§£æ https://en.wikipedia.org/wiki/Bottom-up_parsing [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:16)
17. LL æ–‡æ³•æ˜¯ä¸€ç§ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼Œå¯ä»¥ä½¿ç”¨ LL è§£æå™¨è§£æ https://en.wikipedia.org/wiki/LL_grammar [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:17)
18. LR è§£æå™¨æ˜¯ä¸€ç§è‡ªåº•å‘ä¸Šçš„è§£æå™¨ï¼Œå®ƒæœ‰å¾ˆå¤š SLRã€LALRã€ç­‰å˜ç§ https://en.wikipedia.org/wiki/LR_parser [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:18)
19. https://en.wikipedia.org/wiki/Lookahead [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:19)
20. å…³äº Go è¯­è¨€æ–‡æ³•çš„è®¨è®º https://groups.google.com/forum/#!msg/golang-nuts/jVjbH2-emMQ/UdZlSNhd3DwJ [â†©ï¸](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-lexer-and-parser/#fnref:20)



## åŸæ–‡é“¾æ¥

[å·¦ä¹¦ç¥º - 2.3 ç±»å‹æ£€æŸ¥](https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-typecheck)