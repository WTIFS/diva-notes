CAP理论告诉我们，一个分布式系统不可能同时满足以下三种

- 一致性（C: Consistency）
- 可用性（A: Available）
- 分区容错性（P: Partition Tolerance）

这三个基本需求，最多只能同时满足其中的两项，因为P是必须的，因此往往选择就在CP或者AP中。



### Redis保证的是AP

#### 一致性
向Redis主节点写入数据后，会立即返回结果。之后在主节点会以异步同步给从节点。

但如果同步失败，另一个线程读取的Slave节点中的数据，发现没有添加分布式锁，此时就会出现问题。




### ZooKeeper保证的是CP

#### 一致性
在基于 zk 实现的 CP 架构的分布式模型中，向节点1写入数据后，会等待数据的同步结果，当数据在大多数 zk 节点间同步成功后，才会返回结果数据。

#### 可用性
不能保证每次服务请求的可用性。如果 `leader` 节点挂了，那么整个集群将暂停对外服务，进入新一轮 `leader` 选举。选举会持续 `30s-120s` 。

`zk` 的 `leader` 每次同步数据给 `follower` 时，也不会确保同步给所有节点，只要有大多数节点（`n/2+1`）同步成功即可。因此如果超过半数节点挂掉，集群会无法选举，也就无法正常服务。



#### 参考

> [ZooKeeper和CAP理论及一致性原则](https://blog.csdn.net/yanpenglei/article/details/80362561)