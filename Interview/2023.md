[TOC]

### 问题摘录




#### 职业发展

看机会的原因？
1. 工作内容与职业规划不符
2. 业务前景

看新机会重点关注哪些方面

1. 公司、部门发展前景、业务前景
2. 技术水平、技术积累。希望公司的业务具有一定的规模和挑战性，能够让我在业务上有所提高和突破
3. 团队氛围、公司文化积极向上，注重员工发展，生活和工作平衡

如何判断核心业务和部门发展的前景？（简单来说就是把部门砍掉对公司的业务会不会有影响）

不太认同哪些企业文化？

入职时间；去年绩效；当前薪资；有调薪吗；期望薪资；住址

职业规划、个人的学习和发展，符合自己预期吗？

1. 在Golang后端领域成为一名优秀的技术专家。我对技术有很强的热情，希望能够不断地学习和提升自己，不断掌握新技术，接触和学习新业务，提升自己的技术深度和广度。（比如最近火热的AI）有独立负责一个大型项目的能力了，在技术选型、架构设计和代码质量方面发挥更大作用。

2. 前3年：入门，打好基础，找到感兴趣的方向。3~5年：精通自己所做的业务，了解自己使用的中间件，有较好的技术深度，能够独立负责多个业务模块。5~10年：在技术广度上进一步提升，在技术选型、架构设计上有资深的经验，有独立负责一个大型项目的能力

 个人优缺点、性格上的优势？这个突出的特质一定是意味着绝大部分人没有的，这个特质会带来价值

技术在以往各公司里的价值定位？

过往公司招聘培养曲线是什么样的？导师的机制？应该分多少的精力？怎么去激励导师？



#### 管理

技术怎么制定OKR

1. 高效能 + 高质量 + 可持续
2. 高效能：需求交付快；低运营、免运营；迭代快
3. 高质量：用户体验好；高安全性；故障率低
4. 可持续：代码可读性可维护性、解决负债

一个好的系统，它的代码你觉得应该符合哪些要求？你对代码的要求会是怎么样？（可靠性，四个九；高性能；可读性；归因要准确性）

给你们的系统打多少分？（架构设计、性能；稳定性、错误率；可读性）

（技术要背业务指标吗？）你觉得该背吗？假设，比如说我们什么都不做，然后突然变化了，那我们要去想一些办法再去优化。主要是看我们优化的那一段挽回多少。这个项目做的好与不好，是不是一起愿意去深入的理解一些很细节的业务

同学本身能力不齐，怎么样去在人或者事情上，把控这个稳定性（代码规范；CICI集成代码质量扫描、单测；编码前的技术选型、方案对比、方案评审；代码 review）

业务上又要赶需求，技术上又要设计好系统架构，怎么把杂乱的功能做出更好的抽象？（两个派系：1需要你有较高的业务和技术水平，设计一个较全面、通用、扩展的系统，难度高，容易过度优化；2先做零散的业务开发，技术债堆积到一定程度在回过头做总结、做抽象）。平时稍微付一些小成本，把代码保证一定的质量即可。

一个个人贡献者和一个团队的一个管理者有什么不一样？

如果让你当当前团队 TL，你觉得当前最重要的问题是什么？要怎么解决它？

工作压力大吗？怎么算压力大？

老板拍项目，评估时觉得规定时间内搞不定，且其他的团队不一定能够推得动，如何处理？（Never say no，有条件的 yes：不保质/多给时间、只做核心需求；其他团队推动的话找自己老板、他们老板）目标拉齐，借力推动，借老板的力量来推行。

加班怎么跟下面的同学解释？

下面同学搞不定项目怎么办？

项目太多了，怎么处理？（排优先级）





#### 项目、业务

服务架构、技术栈

业务难点 / 项目要做好的话，关键点有哪些？哪些项目比较有意思？

架构上重点要解决的核心难点？比别人有什么更好的架构，比如成本更低？

做这项业务带来的收益，怎么衡量业务收益？

技术难点、遇到的技术问题

- 布隆过滤器原理
- 布谷鸟过滤器原理
- 稳定性保障、容灾容错上实践的经验
- 技术上可优化的点
- 做一个短的技术规划来做这些优化，你会怎么做呢

有哪些业务指标？请求数量级？广告数量级？如何保障业务指标？

21年的OKR是什么？做的比较成功的一次 OKR 的 O 是什么？

想提升某一个具体的业务目标，比如日活，如何落地？（参考：1. 老板给的是结果，需要找出关键点、突破点（抓手）；2. 建立一个良好的目标体系，把结果指标拆为多个目标和关键节点，盯着关键节点做优化



#### 技术

##### Golang

GMP介绍？偷窃时机？写入全局 G 队列的时机？如何启动 GMP的？协程VS线程（轻量、用户态）

M 和我们的实际线程是 1: 1 的吗，或者说有调过做大线程数吗？（是 M：N，可通过 GOMAXPROCS 调并行 P 的数量）哪些情况下 M 的数量会超过 P？（没有足够的 `M`  与 `P` 关联运行；sysmon；阻塞性系统调用；GC时） 

内存分配（基于TCMalloc，mspan、mcachex线程缓存、mcentral中心缓存、mheap页堆）

垃圾回收

- 根可达、三色标记、混合写屏障
- 垃圾回收时机：1. malloc 时检测到堆大小到达触发阈值；2. sysmon 每2分钟一次；3. 手动执行 runtime.GC
- GC 会占用一定的 CPU，怎么限制 GC 的 CPU 使用率？（默认25%，若分配内存的速度大于GC速度，申请内存的协程会转去辅助GC；可调节 GC 频率）
- GC 优化的思路，如何减少 GC 次数（减少堆上对象数量：提前预估和分配切片、map容量减少扩容；sync.Pool 复用对象；协程复用；减少GC频率：GOGC 环境变量（1.19前）、GOMEMLIMIT 环境变量（1.19）；压舱石）

性能调试手段：benchmark；pprof 看火焰图

服务性能优化有哪些思路？（pprof 看火焰图：去掉一些没用的分支；fail fast；串行改并行；使用本地缓存；分片减小锁粒度；数据库设计合理的索引，利用覆盖索引避免回表；GC优化；协程复用）用过哪些优化工具？

channel 结构

Context 用途？（并发安全的传递上下文）底层实现？（Context 只定义了接口，库提供了四种实现 emptyCtx, cancelCtx, timerCtx, valueCtx）怎么实现超时的？（会开启一个 timer，到期后关闭 Done 这个 channel，下游通过监听 ctx.Done() 判断是否超时）

有哪些阻塞场景（没理解好问题，其实就是问哪些代码可以阻塞程序向下继续执行，这些代码有：channel/select；sync 包下的原子量和互斥量；sleep；网络IO（如http.Get）；文件IO；for/goto 循环）

有哪些 panic 无法被 recover 捕获：并发读写map；死锁；栈溢出；OOM

并发读写场景怎么解决：用 sync.Map

代码执行顺序：import、const、var、init；先初始化 import 导入的包（包实际上是一棵树结构，递归到根节点包，从根节点开始 import），然后是常量、变量、init 函数（先执行的也是根节点包的 init 函数）

make & new 的区别（make 只用于创建并初始化内置数据结构切片、map、channel；new 可用于任何类型，申请内存空间并返回指针）

引用类型有哪些（slice、map、channel、指针、interface、function（text段））

interface 能否做等于的比较（interface 由实际动态类型 + 值两部分构成，不同实例的类型和值都相等时 == 才为 true）

struct 能否比较（字段不含不可比较类型时如 map，就可以；否则编译器会直接报错）

Go 的最新版本有哪些特性（1.14 优化 timer；1.18 支持泛型；1.20 实验特性：arena。面试官想问 1.19 GOMEMLIMIT 这个 GC 的环境变量）

关注Golang以外的技术栈吗？

内存泄露问题有遇到过吗？（没有。参考：可能内存泄露的常景如下：协程结束后会放回空闲池，占用内存；map 扩容后不会缩容；没有关闭资源（Close文件、网络连接、requestBody）；向 channel 发送数据但没有接收，浪费缓冲区；两个对象循环引用）

逃逸分析是什么，作用是什么（根据变量的作用域判断应到分配到栈还是堆上；优先分配到栈上，减少GC）什么情况下变量会发生逃逸？（变量在函数外被引用；变量的引用被函数返回；变量被闭包引用）

Go 里面有哪些并发安全的类型？（sync包下的锁、信号量；channel）

普通类型并发安全的有哪些？（参考：由一条机器指令完成赋值的类型并发赋值是安全的，这些类型有：byte，bool、整型、浮点型、字符型、指针、函数）

atomic 是什么原理？（参考：CAS）

多个字符串拼接过程是什么样的？（参考：为新的字符串创建一个新的内存空间，并将原来的两个字符串的内容复制到新的内存空间中。多个字符串拼接可使用 `strings.Builder` ，更高效，原理为预分配足够的内存空间来避免加号的每次生成新字符串）

Go里的定时器怎么做的（全局最小堆、64个四叉堆、每个P一个四叉堆，改进点）有其他的实现吗？（时间轮）优缺点？（最小堆插入删除是 O(lgN)，时间轮有踏空、空间浪费的问题）

Go网络多路复用的模型（epoll）用的 ET 还是 LT？（ET，只触发一次，效率更高）ET 如果数据没读完，比如碰到粘包的问题，一个TCP连接传输了多个请求，ET如何处理？（这个应该是应用层做处理，如HTTP里的Content-Length标识包长度；HTTP2里复用单一TCP连接，也会有个streamID字段区分多个请求；TCP层要做可以加分隔符）

unsafe.Pointer 有哪些用法？（指针，可以做 string/byte 互转；也可以利用第一个成员地址+偏移量读取数组、切片、结构体的任意成员字段；间接操作未导出变量、字段）

unsafe.Pointer 和 uintptr 的区别？（unsafe.Pointer 指向的对象不会被 GC；uintptr 存的地址上的对象会被 GC）

fasthttp 为什么性能好？（使用 sync.Pool 复用 context/req/res 等对象；使用 slice 代替 map 存储请求里的 kv；使用 []byte（可修改，空间可复用）代替 string；使用 unsafe.Pointer 避免 byte/string 转换时的拷贝）

fasthttp 有哪些坑？（参考：1. 由于复用了 context，如果 context 别下个请求复用时，上个请求中另起的协程还在对它写，高并发下就会导致 request body 错乱；2. 必须设置超时，否则请求处理阻塞后连接不会释放，连接池会被打满）

sync.Pool 可以用来池化网络连接吗？（不能，放回的网络连接对象可能被 GC 掉）

sync.Pool 适用于什么样的场景？（缓存临时、生命周期短的对象）

怎么实现协程池？（应当说是实现一个任务池，或者说复用少量协程处理多个任务：用 channel/sync.Pool 保存任务，起 100 个协程从 channel 中取任务执行）





##### 架构

RTA服务如何加入地域定向功能？

微服务数据冗余如何做强一致性？（分布式事务：如2PC；事件驱动：通过消息队列写并实现幂等写入；数据复制：通过同步工具如Canal来实现数据复制）

服务治理：负载均衡、限流、熔断、降级怎么做的？

高可靠性、高性能你会用些什么样的方法？（可靠性：网关健康检查、限流、熔断、降级；高性能：负载均衡、缓存）有没有遇到过性能的问题？（pprof火焰图）

CPU Load 有三个值，看的是哪个（不会，`top` 命令看的是用户进程、系统进程、空闲 CPU 使用率； `uptime` 命令可看到三个值，表示1、5、15分钟的 CPU 平均使用率）

如果 CPU使用率变高了，从哪几个方面去入手去看（先看近期服务的上线、配置变更记录、下游服务变更记录；使用 pprof 火焰图分析耗时函数、trace 分析协程的系统调用、阻塞、GC等统计信息，然后针对性的优化）

如果接口耗时变高，从系统层面（CPU、内存）会体现在什么值比较高？（CPU使用率、内存使用率、网络IO、磁盘IO变高都可能导致接口耗时上升，都可能体现）

介绍下限流用的令牌桶

熔断触发后怎么恢复的（定时器一定时间后将熔断状态改为半开路状态）

什么情况下考虑使用缓存，用缓存需要关注哪些问题？（1. 低耗时场景，数据库访问慢；2. 数据访问频繁的场景，为数据库减压；3. 数据计算或查询成本高（如聚合报表），可以将计算结果放入缓存；4. session 这种共享内存场景；5. 分布式锁）关注（1. 缓存命中率；2. 缓存失效策略；3. 缓存容量；4. 缓存一致性）

服务治理包含哪些东西？（参考：服务注册与发现；负载均衡；熔断与降级；配置管理；监控与告警；日志与追踪；安全管理）

服务治理里节点摘除是一个什么样的功能？（节点出现故障或者异常情况时，将该节点从服务列表中摘除，防止继续提供服务，避免对整个系统的稳定性产生不良影响）

RPC调用的超时阈值一般如何设置？（上游超时值 和 下游99分位耗时 + buffer 中的较小值；还要考虑自己内部的这个串并行的访问模式的问题，串行有时不行，还得做一些并行的优化，保障对外的吞吐延时达标）

大仓和微服务模式的优缺点？（大仓：耦合，自己的模块受其他模块影响，上线要测的模块较多；微服务：解耦，专注自己服务，其他服务可以mock；但管理困难）

微服务模式下，查问题定位的时候可能涉及到多个服务，不好做，设计服务框架时，最好应该注意哪些事项？（服务治理功能，包含完善的 tracing链路追踪、日志、服务发现、调用分析）



##### 系统设计

集卡、抽卡、开奖系统的设计

设计一个逻辑保证微信这种消息软件收发消息不丢失（为消息设计ID、推拉结合，若用户在线使用推；不在线则由客户端定期拉。推拉都需要客户端回复已读取的消息ID作为已读偏移量记录在服务端；若同时触发推拉由客户端根据消息ID去重

对同一用户曝光多次同样的广告导致点击率降低，设计曝光频控，限制 T 时间内最多为同一用户展示 N 次同样的广告；怎么减少空间复杂度？怎么设置合理的 T 和 N？

2000亿个请求，去 redis 里查询，能识别的只有 80 亿。哪里可以优化？（前置布隆过滤器）

做一个定时服务，可以在指定时间后返回响应。要求可扩容，高可用（时间轮，到期后将通知写入另外的队列服务）

设计一个类似滴滴的派单系统 (https://zhuanlan.zhihu.com/p/552713521)；1. 将司机和乘客分为两个队列，队列里选择较近的司乘，进行匹配。难点：司机和乘客是动态变化的，解决：批处理的思路，等一会儿，积累半分钟后再进行匹配。2. 划分区域，打散队列，每个队列里选择



##### devops

CI、CD的手段？（gitlab 版本控制：CI持续集成：代码检查、单测、构建、发布到测试环境；CD 持续部署：构建、生产环境灰度发布、蓝绿发布）

怎么做监控和数据采集的？（机器上有 agent 上报机器状态；prometheus + grafana）



##### 计算机基础

在浏览器里边用户输入一个 URL 地址之后发生了哪些事情？（解析URL；SSL握手；TCP握手；逐层封装包；网卡发出经过交换机、路由器路由至服务器；解包；数据到达服务器）机房架构和服务架构呢？（多机房 DNS 就近路由）多机房数据如何同步？（1. 多地区数据独立；2. 两个机房搭专线同步数据）第一种方式叫单元化，单元化也要做双机房

小数产生精度丢失的原因？（参考：小数的存储方式为：尾数 + 基数 + 指数，若尾数过长就会被截断，产生误差）

写一行 "hello world"，到打印期间都发生了什么？（参考答案：编译：词法分析、语法分析、中间代码生成、代码优化、生成二进制可执行文件；fork 进程，加载文件中的指令和数据到内存，执行指令：print 切到内核态，调用 write，将字符串写入 STDOUT `dev/stdout` 重定向到 `/dev/console`；写到显示设备的缓冲区，最终在屏幕上显示出来）

可执行文件中的内容是什么样的？（参考答案：ELF Header，代码段，数据段）




#### 中间件
##### Redis

常用数据结构

- Redis也可以基于地理位置做查询：GEO数据类型，使用 GeoHash 编码

缓存穿透概念及解决方案（查不存在的数据）

持久化方式（RDB快照、AOF日志）

过期策略（定期扫描、惰性删除、驱逐时删除）驱逐策略（LRU/LFU/随机/不驱逐）

缓存数据一致性怎么保证？

Redis 如何保证命令的原子性？（inc 这种命令天然支持；如果是先查询后写入就不能保证）这种情况下有什么办法保证原子性？（lua脚本）

redis-cluster 的路由表是怎么管理的（每个节点记录自己负责的 slot，也记录其他节点负责的 slot）

节点什么时候能感知其他节点的 slots 变化？（其他节点 slots 发生变化时会通过 gossip 协议通知更新）

gossip 有哪些消息？meet、ping、pong、fail

Redis 怎么保证并发请求下顺序执行的？（单线程就是顺序执行；6.0 以后用多线程处理网络IO事件，但命令的执行仍然是单线程的，因此是按顺序执行的）

Redis 单线程可能会遇到什么问题？（无法利用多核）

Redis 有没有可能出现性能问题？有了解过就 Redis 常用命令的一些时间复杂度吗？哪些命令时间复杂度会比较高？（应该是想问 KEYS 命令，会扫全表

Redis 分布式锁怎么实现，要注意哪些地方（SETNX，要设稍长的过期时间，要设 value）



##### Kafka

ack参数有哪些取值（all/0/1）

commit offset 有哪几种方式（自动（可能没处理完就提交）、手动（处理完才提交 ≈ 幂等，处理时间太长会导致堆积、被踢掉））

kafka 如何保证消息不丢失 / 高可靠？（生产：多副本机制；ack + ISR 机制；消费：commit 机制，保证消息消费完才提交）

消费者组作用（1. 一个组内的消费者可以并发消费，提高性能；2. 消费模式灵活，不同组可以独立消费互不影响；3. 便于容灾，组内一个消费者挂掉后会触发再平衡，其他消费者接管消费）

Partition 的作用？（物理分片，提高并发吞吐）

写多个 broker，如何保证写入的高效（只写 leader，follower 隔段时间来同步；有三个可靠性级别，由 ack 参数控制，可配置发后即忘、等待 leader 写完、等待所有 ISR 写完）



##### DB

MySQL 索引原理；和 PG 的区别

PG的索引类型：B树索引，哈希索引，GIN（倒排）索引、GiST索引

B+树优势是什么；哈希索引不适合做什么（范围查找和排序）

对倒排索引有了解过吗，有用过 ES 吗？

亿级数据怎么设计存储（HDFS这种分布式存储；数据库分库分表）

DB主从有异地吗（没有，只有微信、支付宝这种非常核心的才做）

数据库怎么实现乐观锁？（CAS思路，更新后检查影响行数）悲观锁？（SELECT FOR UPDATE）

MPP 架构数据库怎么做的？（分布式，并行计算，FE、BE 存储计算分离方便扩展）

覆盖索引，是从哪里读取的？内存还是硬盘？（参考：先从硬盘加载到内存，再从内存读取）



##### k8s

简单说下 k8s 原理？（master + node 两种节点；node 里分 service、pod、container 三层）

k8s 怎么提高发布效率的？（参考：1. 自动化部署：定义好配置文件就可以拉取镜像、创建、配置容器；2. 自动化扩缩容； 3. 多版本控制，方便更新或回滚；4. 自动化更新；5. 提供控制台或API集中化管理）





#### 编码

第 k 大数字（堆/快排）

两个协程交替打印奇偶数

计算二叉树宽度（参考：给二叉树节点加个下标字段即可；当时把空节点也放入队列，下次遍历时忽略左右空节点。有些bug面试官给支出后修改了，还切本地编译器debug了才过，耗时较久）

输入框单词联想功能，讲下思路（字典树）

查找链表倒数第 k 个节点

k个一组反转链表

DP三角形最短路径和

计算字符串编辑距离 [72. Edit Distance (Hard)](https://leetcode.com/problems/edit-distance/)

1G内存，10G数据，找其中的一个重复数据（按1G分割并排序后对比；更优的办法是用 bitmap）

统计 日志中 Top 10 IP（大文件按IP段分割为小文件，分别统计）

BST 转成链表

LRU缓存 + TTL（在 LRU 的基础上，value 里记录过期时间，Get 时再判断过期并惰性删除）

根据日期差计算周几 类似 [LeetCode 1154. Day of The Year](https://leetcode.com/problems/day-of-the-year/)

两组时间区间，取交集

括号校验 [20. Validate Parentheses](https://leetcode.com/problems/valid-parentheses/)
