# 进程 & 线程



## 相同

本质上是同一个东西，都是是程序的环境、上下文（Contenxt of Excution, COE）。如 CPU状态（寄存器等），内存状态（页表等），通信状态（打开的文件描述符 `fd`、信号处理器等）。

在 `Linux` 的实现上，进程和线程都是用同一个结构体 `task_struct` 来描述的。 进程的 `fork`、`vfork`，线程的 `pthread_create`，底层也都是调用的 `clone`，只是传入的参数不同。



## 不同

进程是 **资源分配** 的最小单位，线程是 **CPU调度** 的最小单位。

做个简单的比喻：进程=火车，线程=车厢

- 线程在进程下行进
    - 单纯的车厢无法运行

- 一个进程可以包含多个线程
    - 一辆火车可以有多个车厢

- 不同进程间数据很难共享，需要通过管道等方式
    - 一辆火车上的乘客很难换到另外一辆火车，比如站点换乘
- 同一进程下不同线程间共享内存，数据很易共享
    - A车厢换到B车厢很容易
- 进程要比线程消耗更多的计算机资源
    - 采用多列火车相比多个车厢更耗资源
- 进程间不会相互影响，一个线程挂掉可能导致整个进程挂掉
    - 操作系统发现线程错误可能直接kill掉进程；一个挂掉的线程写入的错误数据也可能导致其他线程挂掉
    - 一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢着火了，将影响到所有车厢
- 进程可以拓展到多机，进程最多适合多核
    - 不同火车可以开在多个轨道上，同一火车的车厢不能在行进的不同的轨道上
- 进程可以给自己使用的内存地址上锁，即一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存
    - 比如火车上的洗手间 - 互斥锁
- 进程可以给资源限流
    - 比如火车上的餐厅，最多只允许多少人进入，如果满了需要在门口等 - 信号量





## 问题

##### 为什么 nginx 用多进程而不是多线程架构？

- 多进程部分是为了高可用，`master` 进程会监控各 `slave` 进程状态，在 `slave` 异常时对其进行重启





#### 参考

> [biaodianfu - 线程和进程的区别是什么？](https://www.zhihu.com/question/25532384/answer/411179772)

