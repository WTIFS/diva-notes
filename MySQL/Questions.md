#### 查询执行流程是什么





#### MySQL通过什么样的机制保证事务原子性？

  - undo log



#### B+树和B树的区别

- B+树属于加强版的 B树，拥有 B树的所有优势
- 最大的区别是只有叶子节点存数据，非叶子结点只存关键字；并且节点直接顺序排列
- 优势：
  - 非叶子结点只存关键字，体积极小，索引可以全部放入内存中，查询很快。需要取数据时再读取硬盘，把页上的数据加载进内存
  - 节点直接通过指针相连，顺序读取能力更强、排序能力也更强



#### B+树的叶节点的结构





#### MySQL的排序过程是什么样的？

  - 排序字段命中索引：索引本身就是有序的，顺序遍历即可
  - 未命中索引：Using filesort
    - 数据量小时，内存排序（快排）
    - 数据量大时，外部文件排序（归并排序）
    - 如果有 `LIMIT`，会用大根堆 / 小根堆做堆排
    - 缓存区大小由参数配置



#### 假如两个事务执行写操作，过程是什么样的？

假如事务1和事务2都要执行 `update` 操作
- 命中索引的情况下，事务1先 `update` 数据行的时候，先会获取行锁，锁定数据，当事务2要进行 `update` 操作的时候，也会取获取该数据行的行锁，但是已经被事务1占有，事务2只能等待
- 若是没有索引的条件下，就获取所有行，都加上行锁，然后 MySQL 会再次过滤符合条件的的行并释放锁，只有符合条件的行才会继续持有锁

